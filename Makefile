SHELL = /bin/sh

# --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# --- Setup ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

.PHONY: install-lefthook

install-lefthook:
	(command -v lefthook || go install github.com/evilmartians/lefthook@latest) && lefthook install

# --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# --- Go (Golang) ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

.PHONY: go-mod-clean go-mod-tidy go-mod-update go-fmt go-lint go-test

go-mod-clean:
	go clean -modcache

go-mod-tidy:
	go mod tidy

go-mod-update:
	go get -f -t -u ./...
	go get -f -u ./...

go-fmt:
	(command -v golangci-lint || go install github.com/golangci/golangci-lint/v2/cmd/golangci-lint@v2.0.2) && golangci-lint fmt ./...

go-lint: go-fmt
	golangci-lint run ./...

go-test:
	go test -v -race ./...

# --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# --- Help -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

.PHONY: help
help:
	@echo ""
	@echo "Available commands:"
	@echo ""
	@echo " Setup:"
	@echo ""
	@echo "  install-lefthook ............... Install lefthook (Git hooks manager)."
	@echo ""
	@echo " Go (Golang):"
	@echo ""
	@echo "  go-mod-clean ................... Clean Go module cache."
	@echo "  go-mod-tidy .................... Tidy Go modules."
	@echo "  go-mod-update .................. Update Go modules."
	@echo "  go-fmt ......................... Format Go code."
	@echo "  go-lint ........................ Lint Go code."
	@echo "  go-test ........................ Run Go tests."
	@echo ""
	@echo " Help:"
	@echo ""
	@echo "  help ........................... Display this help information."
	@echo ""

.DEFAULT_GOAL = help